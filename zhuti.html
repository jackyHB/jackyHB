<html lang="zh"><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <title>哔咚哔咚</title>
</head>

<body style="height:100vh;width:100%;background-attachment:fixed;background-size: cover;-webkit-background-size: cover;-o-background-size: cover;background-image:url(https://raw.githubusercontent.com/jackyHB/jackyHB/main/9B4F70BB-2B39-44FE-9940-83CBEAA3B21C.jpeg);background-repeat: no-repeat;background-position: center 0;">
    <div style="padding-top:10%;text-align:center;">
        <p>
            <img id="hd" class="ani" src="https://s1.hdslb.com/bfs/static/passport/static/img/loadTV.99606e2.gif">
            </p><p style="position: relative;top: 10px; left: 0px;font-size:2vh;color:#fff;">
                <b></b> <br>
            </p>
            <div><img id="qrcode" height="170em" class="middle" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEAAQMAAABmvDolAAAABlBMVEX///8AAABVwtN+AAADaUlEQVR42uyYMY7zLhvEB7mg5AbhIpG5VopIRkrhaznyRfANKCks5tPg3Xez3Vf841AslfW+v5UgPMzM8+Bv/a3/egWSywWW1XNefOYe6MqwkazdACNg1wQ+SDfvF9jdJDdzy+2/TgI853XL5JOwZLZx9C6GLXPvDGBmHME4kDoOy9WcDSwXx0cFJm2Sz+QKOgMAK4ALsl1MLsefmF/18GZAZb9uudxH7+aXj1/v4tOA1kAWwGNaDMtQPRDSLxF5M3C8Tcc9pKPsuYBcfPvoBQhkDHoXJpECJGIzmbnjLADezTtcAZBvw5bt48k86V+G2hHAeDW0j8Wz4ALGr6u2cTwLGKEttQ+WVnuBTh7EjgCARfuenrru6iyZcLsaYljOAgyzXSlZgCM3tmtFSM5+6UMPQEguXk22DzLfJPIxpCZi9kvtTwAMpe3EVIFbSNCNZgwbv0WsEyAO1eEOnydWvQviBp/to54FyF8Wn8vdEHbdst3bR3U/3v15QHu+Xly75ajNS3cnbuSjngXIDdfqyvSkk0dbPtlkv91vJ0BILPC5TIfSOtwNnYh//cX7AYBkcqp2hT0eD0HE9y/ZARDolJaPW1YanJiAQY90OQ1InFdtcvF5UsbbRy9FzT0BRqdITrqqU1CWlHUK8kRAtwkbgaywp2t1XPkvFfcAyLul7VNVkDDZKkyo0TgRMEnaKVtMeVpVbQtcuQLfZd8DEBJj6zHUVlwNW4a/SUl+FObtgCQrNX9pQaLhChJKNb0AI/INQIHcUJY4LWDrLyLOAuA5UyX3PNRUJefK9QKRvQBqxIYtczeJMcgfq+e8X9xrp/ZmQBmGFXaHb5XWNhnDxteg9XFAlabs91TdKRvCt7f504idAGBak1N019vMpYX5UPEyqPk4YIhb2NpULVumnzRhd5wGJIU94C6P3i9H+2AVZqbaD8DcvHFvSmJy61h1gh/vfjsQpF0XV47655GKY5A19wM0O1LICcxWXeHdpDZVK8NpQDh2U47Ud8zSXRm2F0v6PNDmtP4YrbVsE0OCojMf9TSgzavRttSmixKyWWEvjn0BbY7nj9i867fd4b6HRecBepLST4fhyWbY37OgLoAjJKsR49wyvDrWXT3+eBbQBvsJ9rH4Ix5Hk3ALZEE/wN/6W///+l8AAAD//+Hpfdz8SMxEAAAAAElFTkSuQmCC"></div>
            <p style="font-size:3vh;color:#00BFFF;">
                <b>扫码登陆</b> <br>
            </p>
            <a style="position: relative;top: 20px; left: 0px;border-radius:8px;padding:6px 20px;font-size:2vh;color:#00BFFF;border-style:solid;text-decoration:none;" id="jumpapp" href="#">京东APP登陆</a>
            
            <script type="text/javascript" color="255,255,255" opacity="0.7" zindex="-2" count="200" src="https://cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
    </div><canvas id="c_n4" width="537" height="876" style="position: fixed; top: 0px; left: 0px; z-index: -2; opacity: 0.7;"></canvas><canvas id="c_n4" width="537" style="position: fixed; top: 0px; left: 0px; z-index: -2; opacity: 0.7;" height="876"></canvas>

<script>
    var timer;
    var qrcode = document.getElementById("qrcode")
    var loginUrl = ""
    var success = "https://ghproxy.com/https://raw.githubusercontent.com/cdle/jd_study/main/xdd/static/ok.svg";
    var jumpapp = document.getElementById('jumpapp')
    var hd = document.getElementById("hd")

    function showQrcode() {
        var xmlhttp = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                data = JSON.parse(xmlhttp.responseText)
                if (data.url && data.url.indexOf("http") != -1) {
                    qrcode.src = "data:image/png;base64," + data.img
                    loginUrl = data.url
                } else {
                    showQrcode()
                }
            }
        }
        xmlhttp.open("GET", "/api/login/qrcode", true);
        xmlhttp.send();
    }
    showQrcode()

    function login() {
        var xmlhttp = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var results = xmlhttp.responseText
                console.log(results)
                switch (results) {
                    case "授权登录未确认":
                        break;
                    case "登录":
                        hd.style.visibility = "hidden";
                        qrcode.src = success
                        clearInterval(timer)
                        setTimeout(() => {
                            window.location.href = "/admin"
                        }, 1000);
                        break;
                    case "成功":
                        hd.style.visibility = "hidden";
                        qrcode.src = success
                        clearInterval(timer)
                        break;
                    default:
                        showQrcode()
                        break;
                }
            }
        }
        xmlhttp.open("GET", "/api/login/query", true);
        xmlhttp.send();
    }

    function polling() {
        timer = setInterval(() => {
            login()
        }, 1500);
    }
    polling()

    jumpapp.addEventListener('click', function() {
        if (loginUrl) {
            window.location.href = `openapp.jdmobile://virtual/ad?params=${encodeURI(
                JSON.stringify({
                    category: 'jump',
                    des: 'ThirdPartyLogin',
                    action: 'to',
                    onekeylogin: 'return',
                    url: loginUrl,
                    authlogin_returnurl: 'weixin://',
                    browserlogin_fromurl: window.location.host,
                })
            )}`;
        } else {
            alert('还没加载好，请稍后重试');
        }
    })
</script>

</body></html>
